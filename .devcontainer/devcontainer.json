// UV | VS Code - Setup.
//---------------------
// This config is setup to be only specific to VS Code.
// Other configs that do not relate to VS Code are defined in the docker-compose.yml file.
// This enables the dev container setup to be used with other IDEs, ignoring this file.
//---------------------
// Default properties for the devcontainer setup:
// - Default service: "myproject", relates to the service defined in the docker-compose.yml.
// - Default "workspaceFolder" is set to "workspace" (within the "/vscode/" folder in the container).
// For format details, see https://aka.ms/devcontainer.json.
//---------------------

{
	"name": "dev-container-name",
	// Build image using docker compose based on build specs in docker-compose.yml
	"dockerComposeFile": ["./docker-compose.yml"],
	"service": "myproject",
	"runServices": ["myproject"],	
	"workspaceFolder": "/vscode/workspace",
	"postCreateCommand": {
		// Set the permissions for the mounted volume for vscode user.
		// "set-permission-for-vscodeuser-to-mount-volume-venv": "sudo chown -R vscode:vscode /vscode/workspace/.venv",
		"uv-sync--frozen": "uv sync --frozen --no-install-project" // By default, uv installs projects and workspace members in editable mode, such that changes to the source code are immediately reflected in the environment.
	},
	"postStartCommand": {
	},
	"features": {
        "ghcr.io/dhoeric/features/hadolint:1": {}
    },
	"customizations": {
        // When connecting to a docker container your local VS Code starts an instance without extensions to ensure isolation and consistency.
        // Therefore extensions can be specified here for automatic installation when connecting.
        "vscode": {
			"settings": {
				// Define terminal shell for Dev Container.
				"terminal.integrated.profiles.linux": {
					"bash": {
						"path": "/bin/bash"
					}
				},
				"python.pythonPath": "/home/vscode/workspace/.venv/bin/python"
			},
            // Use the VS Code Extensions "Identifier" to define extensions.
            "extensions": [
				// Python
                "ms-python.python",
				// Docker
				"ms-azuretools.vscode-docker",
				"ms-vscode-remote.remote-containers",
				"ms-vscode-remote.remote-ssh-edit",
				"ms-vscode-remote.remote-ssh"
            ]
        }
    },
	"remoteUser": "vscode"
}
